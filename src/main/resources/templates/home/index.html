<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layouts/default_layout :: body(~{::content}, null, ~{::additionalJs})}">

<head>
    <!-- Head stays empty because title/CSS are provided by default_layout -->
</head>
<body>
    <!-- Page Content Fragment -->
    <th:block th:fragment="content">
        <!-- Hero section (visual banner area) -->
        <section class="hero-section text-center d-flex align-items-center justify-content-center">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <h1 class="display-4 fw-bold mb-4" data-aos="fade-up">
                            üå∏ Ch√†o m·ª´ng ƒë·∫øn v·ªõi AloTra üå∏
                        </h1>
                        <p class="lead mb-4" data-aos="fade-up" data-aos-delay="200">
                            Th∆∞·ªüng th·ª©c h∆∞∆°ng v·ªã tr√† s·ªØa tinh t·∫ø nh∆∞ c√°nh hoa anh ƒë√†o
                        </p>
                        <div data-aos="fade-up" data-aos-delay="400">
                            <a th:href="@{/products}" class="btn btn-lg me-3">
                                <i class="fas fa-shopping-bag me-2"></i>Kh√°m ph√° menu
                            </a>
                            <a th:href="@{/promotions}" class="btn btn-outline-light btn-lg">
                                <i class="fas fa-gift me-2"></i>Khuy·∫øn m√£i hot
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Best-sellers product grid -->
        <section class="container my-5" id="best-sellers" data-aos="fade-up">
            <h2 class="section-title">
                <i class="fas fa-star text-warning me-3"></i>
                S·∫¢N PH·∫®M B√ÅN CH·∫†Y
                <i class="fas fa-star text-warning ms-3"></i>
            </h2>
            <div id="product-list-container" class="row row-cols-1 row-cols-md-2 row-cols-lg-5 g-4">
                <!-- Product card -->
                <div class="col" th:each="product, iterStat : ${bestSellers}">
                    <div class="card product-card h-100 position-relative" 
                         data-aos="fade-up" 
                         th:attr="data-aos-delay=${iterStat.index * 100}">
                        <!-- Discount badge -->
                        <span th:if="${product.discountPercent != null and product.discountPercent > 0}"
                              class="badge bg-danger position-absolute" style="top:8px; left:8px; z-index: 2;"
                              th:text="${'-' + product.discountPercent + '%'}">-10%</span>
                        <a th:href="@{'/products/' + ${product.id}}">
                            <img th:src="${product.imageUrl != null and !#strings.isEmpty(product.imageUrl) ? product.imageUrl : '/images/placeholder.png'}"
                                 class="card-img-top" th:alt="${product.name}" />
                        </a>
                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title">
                                <a class="text-decoration-none text-dark" th:href="@{'/products/' + ${product.id}}" th:text="${product.name}">T√™n s·∫£n ph·∫©m</a>
                            </h5>

                            <!-- Price block with discount -->
                            <div class="mt-auto">
                                <div th:if="${product.discountPercent != null and product.discountPercent > 0}">
                                    <div class="text-muted text-decoration-line-through small"
                                         th:text="${#numbers.formatDecimal(product.originalPrice, 0, 'COMMA', 0, 'POINT')} + ' ‚Ç´'">30.000 ‚Ç´</div>
                                    <div class="price text-danger fw-semibold"
                                         th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')} + ' ‚Ç´'">25.000 ‚Ç´</div>
                                </div>
                                <div th:if="${product.discountPercent == null or product.discountPercent <= 0}">
                                    <p class="price mt-1"
                                       th:if="${product.price != null}"
                                       th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT') + ' ‚Ç´'}">Gi√° s·∫£n ph·∫©m</p>
                                    <p class="text-muted mt-1" th:if="${product.price == null}">ƒêang c·∫≠p nh·∫≠t gi√°</p>
                                </div>
                            </div>

                            <!-- Add to cart: GET link to /cart/add with productId; disabled when price missing -->
                            <a th:if="${product.price != null}"
                               th:href="@{/products/{id}(id=${product.id})}"
                               class="btn btn-add-to-cart mt-2"
                               >
                                <i class="fas fa-shopping-cart"></i> ƒê·∫∑t mua
                            </a>
                            <button th:if="${product.price == null}"
                                    class="btn btn-add-to-cart mt-2" disabled aria-disabled="true">
                                <i class="fas fa-shopping-cart"></i> ƒê·∫∑t mua
                            </button>
                        </div>
                    </div>
                </div>
                <!-- Empty state -->
                <div th:if="${#lists.isEmpty(bestSellers)}" class="col-12 text-center">
                    <p>Ch∆∞a c√≥ s·∫£n ph·∫©m b√°n ch·∫°y n√†o.</p>
                </div>
            </div>

            <!-- View more button (only visible when more than 5 items) -->
            <div class="text-center mt-5" th:if="${#lists.size(bestSellers) > 5}">
                <th:block th:with="hiddenProductCount=${#lists.size(bestSellers) - 5}">
                    <button id="view-more-btn" class="btn btn-outline-success btn-lg"
                            th:text="'Xem th√™m ' + ${hiddenProductCount} + ' s·∫£n ph·∫©m'">
                    </button>
                </th:block>
            </div>
        </section>

        <!-- News & Promotions: card grid -->
        <section class="container my-5" id="news-promotions" data-aos="fade-up">
            <h2 class="section-title">
                <i class="fas fa-bullhorn text-info me-3"></i>
                TIN T·ª®C & KHUY·∫æN M√ÉI
                <i class="fas fa-percent text-info ms-3"></i>
            </h2>

            <style>
                /* Scoped styles for promotions grid */
                #news-promotions .promo-grid { display: grid; gap: 1.25rem; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); }
                #news-promotions .promo-card { background: linear-gradient(135deg, #fff 0%, #fef7f8 100%); border-radius: 16px; box-shadow: 0 8px 25px rgba(214, 51, 132, 0.08); overflow: hidden; display: flex; flex-direction: column; transition: all 0.4s ease; border: 1px solid rgba(214, 51, 132, 0.1); }
                #news-promotions .promo-card:hover { transform: translateY(-8px) scale(1.02); box-shadow: 0 20px 40px rgba(214, 51, 132, 0.15); border-color: rgba(233, 30, 99, 0.2); }
                #news-promotions .promo-thumb img { width: 100%; aspect-ratio: 16/9; object-fit: cover; display: block; }
                #news-promotions .promo-body { padding: 12px 14px 16px; }
                #news-promotions .promo-meta { display: flex; justify-content: space-between; align-items: center; gap: 8px; color: #d63384; font-size: .9rem; font-weight: 600; }
                #news-promotions .promo-title { font-size: 1.1rem; font-weight: 700; margin: .35rem 0; line-height: 1.35; color: #2d1b2e; }
                #news-promotions .promo-title a:hover { color: #e91e63; }
                #news-promotions .promo-desc { color: #6c757d; margin: 0; display: -webkit-box; -webkit-line-clamp: 2; line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
                @media (min-width: 768px) { #news-promotions .promo-title { font-size: 1.1rem; } }
            </style>

            <div class="promo-grid">
                <article class="promo-card" th:each="p, iterStat : ${promotions}"
                         data-aos="zoom-in"
                         th:attr="data-aos-delay=${iterStat.index * 150}">
                    <a class="promo-thumb" th:href="@{'/promotions/' + ${p.id}}">
                        <img th:src="${p.imageUrl != null ? p.imageUrl : '/images/placeholder.png'}" th:alt="${p.title}" />
                    </a>
                    <div class="promo-body">
                        <div class="promo-meta">
                            <span class="promo-time"><i class="far fa-calendar me-1"></i><span th:text="${p.periodText}">--/-- - --/--</span></span>
                            <span class="promo-views"><i class="far fa-eye me-1"></i><span th:text="${p.views}">0</span></span>
                        </div>
                        <h3 class="promo-title"><a class="text-decoration-none text-dark" th:href="@{'/promotions/' + ${p.id}}" th:text="${p.title}">Ti√™u ƒë·ªÅ khuy·∫øn m√£i</a></h3>
                        <p class="promo-desc" th:if="${p.description}" th:text="${p.description}">M√¥ t·∫£ ng·∫Øn...</p>
                    </div>
                </article>
                <div th:if="${#lists.isEmpty(promotions)}" class="text-center text-muted">Ch∆∞a c√≥ khuy·∫øn m√£i n√†o.</div>
            </div>

            <!-- View more button for promotions (same mechanism as best-sellers) -->
            <div class="text-center mt-4" th:if="${#lists.size(promotions) > 5}">
                <th:block th:with="hiddenPromoCount=${#lists.size(promotions) - 5}">
                    <button id="promo-view-more-btn" class="btn btn-outline-success btn-lg"
                            th:text="'Xem th√™m ' + ${hiddenPromoCount} + ' khuy·∫øn m√£i'">
                    </button>
                </th:block>
            </div>
        </section>

        <!-- About section (static marketing copy) -->
        <section class="container my-5 py-5 text-center" data-aos="fade-up" 
                 style="background: linear-gradient(135deg, rgba(255, 107, 157, 0.1), rgba(233, 30, 99, 0.1)); 
                        border-radius: 25px; 
                        backdrop-filter: blur(10px); 
                        border: 1px solid rgba(214, 51, 132, 0.2);
                        box-shadow: 0 10px 30px rgba(214, 51, 132, 0.1);">
            <h2 class="section-title">
                <i class="fas fa-heart text-danger me-3"></i>
                V·ªÅ AloTra
                <i class="fas fa-leaf text-success ms-3"></i>
            </h2>
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <p class="lead mb-4" style="color: #2d1b2e; line-height: 1.8;">
                        üå∏ AloTra mang ƒë·∫øn nh·ªØng ly tr√† s·ªØa ch·∫•t l∆∞·ª£ng, pha ch·∫ø t·ª´ nguy√™n li·ªáu t∆∞∆°i ngon ch·ªçn l·ªçc. 
                        Ch√∫ng t√¥i tin r·∫±ng m·ªói ly tr√† s·ªØa kh√¥ng ch·ªâ l√† th·ª©c u·ªëng, m√† c√≤n l√† ni·ªÅm vui, 
                        l√† kho·∫£nh kh·∫Øc th∆∞ gi√£n tuy·ªát v·ªùi nh∆∞ c√°nh hoa anh ƒë√†o bay trong gi√≥. ‚ú®
                    </p>
                    <div class="d-flex justify-content-center align-items-center flex-wrap gap-3">
                        <div class="text-center">
                            <i class="fas fa-award text-warning fa-2x mb-2"></i>
                            <p class="small fw-bold mb-0">Ch·∫•t l∆∞·ª£ng ƒë·∫£m b·∫£o</p>
                        </div>
                        <div class="text-center">
                            <i class="fas fa-shipping-fast text-primary fa-2x mb-2"></i>
                            <p class="small fw-bold mb-0">Giao h√†ng nhanh</p>
                        </div>
                        <div class="text-center">
                            <i class="fas fa-smile text-success fa-2x mb-2"></i>
                            <p class="small fw-bold mb-0">Kh√°ch h√†ng h√†i l√≤ng</p>
                        </div>
                    </div>
                </div>
            </div>
            <a th:href="@{/about}" class="btn btn-lg mt-4" 
               style="background: linear-gradient(135deg, #ff6b9d, #e91e63); 
                      color: white; 
                      border: none; 
                      border-radius: 25px; 
                      padding: 12px 30px;
                      font-weight: 700;
                      box-shadow: 0 4px 15px rgba(233, 30, 99, 0.3);">
                <i class="fas fa-arrow-right me-2"></i>T√¨m hi·ªÉu th√™m
            </a>
        </section>
    </th:block>

    <!-- Page Scripts Fragment -->
    <th:block th:fragment="additionalJs">
        <script>
            // Simple progressive reveal: show 5 items first, expand on click
            $(document).ready(function() {
                // Best-sellers
                const productContainer = $("#product-list-container");
                const viewMoreBtn = $("#view-more-btn");

                if (productContainer.length && viewMoreBtn.length) {
                    const hiddenProducts = productContainer.find(".col:gt(4)").hide();
                    if (hiddenProducts.length === 0) {
                        viewMoreBtn.hide();
                    }
                    viewMoreBtn.on('click', function() {
                        hiddenProducts.show();
                        $(this).hide();
                    });
                } else {
                    console.log("Kh√¥ng t√¨m th·∫•y product-list-container ho·∫∑c view-more-btn.");
                }

                // Promotions (same mechanism)
                const promoGrid = $("#news-promotions .promo-grid");
                const promoViewMoreBtn = $("#promo-view-more-btn");
                if (promoGrid.length && promoViewMoreBtn.length) {
                    const hiddenPromos = promoGrid.find(".promo-card:gt(4)").hide();
                    if (hiddenPromos.length === 0) {
                        promoViewMoreBtn.hide();
                    }
                    promoViewMoreBtn.on('click', function() {
                        hiddenPromos.show();
                        $(this).hide();
                    });
                }
            });
        </script>
    </th:block>
</body>
</html>