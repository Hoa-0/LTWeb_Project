<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layouts/vendor-layout :: layout(pageTitle='Đơn hàng cần xử lý', pageContent=~{::pageContent})}">
<body>
<div class="page-content" th:fragment="pageContent" th:with="currentPage='vendor-orders'">
    <form class="row g-2 mb-3" method="get" th:action="@{/vendor/orders}">
        <div class="col-md-3">
            <select class="form-select" name="status">
                <option value="" th:selected="${status == null}">Tất cả trạng thái</option>
                <option value="ChoXuLy" th:selected="${status == 'ChoXuLy'}">Chờ xử lý</option>
                <option value="DangPhaChe" th:selected="${status == 'DangPhaChe'}">Đang pha chế</option>
                <option value="DangGiao" th:selected="${status == 'DangGiao'}">Đang giao</option>
                <option value="DaGiao" th:selected="${status == 'DaGiao'}">Đã giao</option>
                <option value="DaHuy" th:selected="${status == 'DaHuy'}">Đã hủy</option>
            </select>
        </div>
        <div class="col-md-4">
            <input class="form-control" name="kw" placeholder="Tìm theo tên KH, SĐT" th:value="${kw}">
        </div>
        <div class="col-md-2">
            <select class="form-select" name="limit">
                <option th:selected="${limit == null}" value="50">Hiện 50</option>
                <option th:selected="${limit == 100}" value="100">Hiện 100</option>
                <option th:selected="${limit == 200}" value="200">Hiện 200</option>
            </select>
        </div>
        <div class="col-md-3">
            <button class="btn btn-outline-success w-100">Lọc</button>
        </div>
    </form>

    <div class="card">
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped table-hover align-middle">
                    <thead>
                    <tr>
                        <th>#</th>
                        <th>Khách hàng</th>
                        <th>Điện thoại</th>
                        <th>Thời gian</th>
                        <th>Trạng thái</th>
                        <th>Thanh toán</th>
                        <th class="text-end">Tổng</th>
                        <th class="text-end">Hành động</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="o : ${items}">
                        <td th:text="${o.id}"></td>
                        <td>
                            <div th:text="${o.customerName}"></div>
                            <div class="small">
                                <span class="badge bg-light text-dark border" th:text="${o.paymentMethod == 'ChuyenKhoan' ? 'Chuyển khoản' : 'Tiền mặt'}"></span>
                            </div>
                        </td>
                        <td th:text="${o.customerPhone}"></td>
                        <td th:text="${#temporals.format(o.createdAt, 'HH:mm dd/MM')}"></td>
                        <td>
                            <span class="badge" th:classappend="${o.status=='ChoXuLy'?'bg-warning':(o.status=='DangPhaChe'?'bg-primary':(o.status=='DangGiao'?'bg-info':(o.status=='DaGiao'?'bg-success':'bg-secondary')))}"
                                  th:text="${o.status}"></span>
                        </td>
                        <td>
                            <span class="badge" th:classappend="${o.paymentStatus=='DaThanhToan'?'bg-success':'bg-secondary'}"
                                  th:text="${o.paymentStatus}"></span>
                        </td>
                        <td class="text-end" th:text="${#numbers.formatDecimal(o.total,0,'COMMA',0,'POINT')} + ' ₫'"></td>
                        <td class="text-end">
                            <div class="d-flex justify-content-end gap-1">
                                <a th:href="@{'/vendor/orders/' + ${o.id}}" class="btn btn-sm btn-outline-secondary">Chi tiết</a>
                                <form th:action="@{'/vendor/orders/' + ${o.id} + '/advance'}" method="post">
                                    <input type="hidden" name="from" th:value="${from}">
                                    <button class="btn btn-sm btn-outline-primary" type="submit"
                                            th:disabled="${(o.paymentMethod=='ChuyenKhoan' && o.paymentStatus!='DaThanhToan') || o.status=='DaGiao' || o.status=='DaHuy'}">Chuyển bước</button>
                                </form>
                                <form th:action="@{'/vendor/orders/' + ${o.id} + '/cancel'}" method="post" onsubmit="return confirm('Hủy đơn này?');">
                                    <input type="hidden" name="from" th:value="${from}">
                                    <button class="btn btn-sm btn-outline-danger" type="submit"
                                            th:disabled="${!(o.status=='ChoXuLy' || o.status=='DangPhaChe')}">Hủy</button>
                                </form>
                                <form th:if="${o.paymentStatus!='DaThanhToan'}" th:action="@{'/vendor/orders/' + ${o.id} + '/mark-cash-paid'}" method="post" onsubmit="return confirm('Xác nhận đã thu tiền từ khách?');">
                                    <input type="hidden" name="from" th:value="${from}">
                                    <button class="btn btn-sm btn-success" type="submit">Đã thu tiền</button>
                                </form>
                            </div>
                        </td>
                    </tr>
                    <tr th:if="${#lists.isEmpty(items)}">
                        <td colspan="8" class="text-center">Không có đơn hàng nào.</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
</body>
</html>